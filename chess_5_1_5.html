<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>"Chess_v5_1_4"</title>

    <style>
        table#board {
            min-width: 80vw;
            min-height: 80vw;
            border-collapse: collapse;
        }

        td {
            background-color: rgb(87, 87, 87);
            text-align: center;
            box-sizing: border-box;
        }

        .kampas {
            height: 6%;
            width: 6%;
            background-color: rgb(58, 57, 57);
        }

        td.zalias,
        td.raudonas {
            padding: 0;
            border: 0px solid #ffffff;

        }

        td.zalias {         /*ateityje naikinti klase ir aprašyti su kasantru vaiku*/
            height: 11%;
            width: 11%;
            background-color: rgb(1, 161, 1);
        }

        td.raudonas {       /*ateityje naikinti klase ir aprašyti su kasantru vaiku*/
            height: 11%;
            width: 11%;
            background-color: #bd2525;
        }

        div {
            background-color: transparent;
            color: white;
            font-size: 3vw;
        }

        div.juoda {
            color: #000000;
            height: 100%;
            width: 100%;
            font-size: 6vw;
            ;
        }

        div.balta {
            color: #ffffff;
            height: 100%;
            width: 100%;
            font-size: 6vw;
        }

        div.virsus {
            transform: rotate(180deg);
            -webkit-transform: rotate(180deg);
            /* Safari/Chrome */
            -moz-transform: rotate(180deg);
            /* Firefox */
            -o-transform: rotate(180deg);
            /* Opera */
            -ms-transform: rotate(180deg);
            /* IE 9 */
        }

        div.kaire {
            transform: rotate(-90deg);
            -webkit-transform: rotate(-90deg);
            /* Safari/Chrome */
            -moz-transform: rotate(-90deg);
            /* Firefox */
            -o-transform: rotate(-90deg);
            /* Opera */
            -ms-transform: rotate(-90deg);
            /* IE 9 */
        }

        div.desine {
            transform: rotate(90deg);
            -webkit-transform: rotate(90deg);
            /* Safari/Chrome */
            -moz-transform: rotate(90deg);
            /* Firefox */
            -o-transform: rotate(90deg);
            /* Opera */
            -ms-transform: rotate(90deg);
            /* IE 9 */
        }

        #ejimai {
            width: 150px;
            border: 1px solid black;
            color: #000;
            size: 12px;
            background-color: #aaaaaa;
            overflow: auto;
        }

        #ejimai td {
            text-align: center;
        }

        #ejimai td:first-child {
            width: 20%;
        }
    </style>
</head>

<body>

    <table id="board">
        <tr>
            <td class="kampas">
            </td>
            <td>
                <div class="virsus">a</div>
            </td>
            <td>
                <div class="virsus">b</div>
            </td>
            <td>
                <div class="virsus">c</div>
            </td>
            <td>
                <div class="virsus">d</div>
            </td>
            <td>
                <div class="virsus">e</div>
            </td>
            <td>
                <div class="virsus">f</div>
            </td>
            <td>
                <div class="virsus">g</div>
            </td>
            <td>
                <div class="virsus">h</div>
            </td>
            <td class="kampas">
            </td>
        </tr>
        <tr>
            <td>
                <div class="kaire">8</div>
            </td>
            <td class="zalias" id="a8" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="bokstasJuodasKaire" class="juoda" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">&#9820;
                </div>
            </td>
            <td class="raudonas" id="b8" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="zirgasJuodasKaire" class="juoda" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">&#9822;
                </div>
            </td>
            <td class="zalias" id="c8" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="rikisJuodasKaire" class="juoda" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">&#9821;
                </div>
            </td>
            <td class="raudonas" id="d8" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="karaliusJuodas" class="juoda" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">&#9819;
                </div>
            </td>
            <td class="zalias" id="e8" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="valdoveJuodas" class="juoda" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">&#9818;
                </div>
            </td>
            <td class="raudonas" id="f8" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="rikisJuodasDesine" class="juoda" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">&#9821;
                </div>
            </td>
            <td class="zalias" id="g8" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="zirgasJuodasDesine" class="juoda" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">&#9822;
                </div>
            </td>
            <td class="raudonas" id="h8" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="bokstasJuodasDesine" class="juoda" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">&#9820;
                </div>
            </td>
            <td>
                <div class="desine">8</div>

            </td>
        </tr>

        <tr>
            <td>
                <div class="kaire">7</div>
            </td>
            <td class="raudonas" id="a7" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="pestininkasJuodas1" class="juoda" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">&#9823;</div>
            </td>
            <td class="zalias" id="b7" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="pestininkasJuodas2" class="juoda" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">&#9823;</div>
            </td>
            <td class="raudonas" id="c7" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="pestininkasJuodas3" class="juoda" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">&#9823;</div>
            </td>
            <td class="zalias" id="d7" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="pestininkasJuodas4" class="juoda" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">&#9823;</div>
            </td>
            <td class="raudonas" id="e7" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="pestininkasJuodas5" class="juoda" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">&#9823;</div>
            </td>
            <td class="zalias" id="f7" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="pestininkasJuodas6" class="juoda" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">&#9823;</div>
            </td>
            <td class="raudonas" id="g7" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="pestininkasJuodas7" class="juoda" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">&#9823;</div>
            </td>
            <td class="zalias" id="h7" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="pestininkasJuodas8" class="juoda" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">&#9823;</div>
            </td>
            <td>
                <div class="desine">7</div>
            </td>
        </tr>
        <tr>
            <td>
                <div class="kaire">6</div>
            </td>
            <td class="zalias" id="a6" ondrop="drop(event)" ondragover="allowDrop(event)">
            </td>
            <td class="raudonas" id="b6" ondrop="drop(event)" ondragover="allowDrop(event)">
            </td>
            <td class="zalias" id="c6" ondrop="drop(event)" ondragover="allowDrop(event)">
            </td>
            <td class="raudonas" id="d6" ondrop="drop(event)" ondragover="allowDrop(event)">
            </td>
            <td class="zalias" id="e6" ondrop="drop(event)" ondragover="allowDrop(event)">
            </td>
            <td class="raudonas" id="f6" ondrop="drop(event)" ondragover="allowDrop(event)">
            </td>
            <td class="zalias" id="g6" ondrop="drop(event)" ondragover="allowDrop(event)">
            </td>
            <td class="raudonas" id="h6" ondrop="drop(event)" ondragover="allowDrop(event)">
            </td>
            <td>
                <div class="desine">6</div>
            </td>
        </tr>
        <tr>
            <td>
                <div class="kaire">5</div>
            </td>
            <td class="raudonas" id="a5" ondrop="drop(event)" ondragover="allowDrop(event)">
            </td>
            <td class="zalias" id="b5" ondrop="drop(event)" ondragover="allowDrop(event)">
            </td>
            <td class="raudonas" id="c5" ondrop="drop(event)" ondragover="allowDrop(event)">
            </td>
            <td class="zalias" id="d5" ondrop="drop(event)" ondragover="allowDrop(event)">
            </td>
            <td class="raudonas" id="e5" ondrop="drop(event)" ondragover="allowDrop(event)">
            </td>
            <td class="zalias" id="f5" ondrop="drop(event)" ondragover="allowDrop(event)">
            </td>
            <td class="raudonas" id="g5" ondrop="drop(event)" ondragover="allowDrop(event)">
            </td>
            <td class="zalias" id="h5" ondrop="drop(event)" ondragover="allowDrop(event)">
            </td>
            <td>
                <div class="desine">5</div>
            </td>
        </tr>
        <tr>
            <td>
                <div class="kaire">4</div>
            </td>
            <td class="zalias" id="a4" ondrop="drop(event)" ondragover="allowDrop(event)">
            </td>
            <td class="raudonas" id="b4" ondrop="drop(event)" ondragover="allowDrop(event)">
            </td>
            <td class="zalias" id="c4" ondrop="drop(event)" ondragover="allowDrop(event)">
            </td>
            <td class="raudonas" id="d4" ondrop="drop(event)" ondragover="allowDrop(event)">
            </td>
            <td class="zalias" id="e4" ondrop="drop(event)" ondragover="allowDrop(event)">
            </td>
            <td class="raudonas" id="f4" ondrop="drop(event)" ondragover="allowDrop(event)">
            </td>
            <td class="zalias" id="g4" ondrop="drop(event)" ondragover="allowDrop(event)">
            </td>
            <td class="raudonas" id="h4" ondrop="drop(event)" ondragover="allowDrop(event)">
            </td>
            <td>
                <div class="desine">4</div>
            </td>
        </tr>
        <tr>
            <td>
                <div class="kaire">3</div>
            </td>
            <td class="raudonas" id="a3" ondrop="drop(event)" ondragover="allowDrop(event)">
            </td>
            <td class="zalias" id="b3" ondrop="drop(event)" ondragover="allowDrop(event)">
            </td>
            <td class="raudonas" id="c3" ondrop="drop(event)" ondragover="allowDrop(event)">
            </td>
            <td class="zalias" id="d3" ondrop="drop(event)" ondragover="allowDrop(event)">
            </td>
            <td class="raudonas" id="e3" ondrop="drop(event)" ondragover="allowDrop(event)">
            </td>
            <td class="zalias" id="f3" ondrop="drop(event)" ondragover="allowDrop(event)">
            </td>
            <td class="raudonas" id="g3" ondrop="drop(event)" ondragover="allowDrop(event)">
            </td>
            <td class="zalias" id="h3" ondrop="drop(event)" ondragover="allowDrop(event)">
            </td>
            <td>
                <div class="desine">3</div>
            </td>
        </tr>
        <tr>
            <td>
                <div class="kaire">2</div>
            </td>
            <td class="zalias" id="a2" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="pestininkasBaltas1" class="balta" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">&#9823;</div>
            </td>
            <td class="raudonas" id="b2" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="pestininkasBaltas2" class="balta" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">&#9823;</div>
            </td>
            <td class="zalias" id="c2" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="pestininkasBaltas3" class="balta" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">&#9823;</div>
            </td>
            <td class="raudonas" id="d2" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="pestininkasBaltas4" class="balta" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">&#9823;</div>
            </td>
            <td class="zalias" id="e2" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="pestininkasBaltas5" class="balta" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">&#9823;</div>
            </td>
            <td class="raudonas" id="f2" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="pestininkasBaltas6" class="balta" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">&#9823;</div>
            </td>
            <td class="zalias" id="g2" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="pestininkasBaltas7" class="balta" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">&#9823;</div>
            </td>
            <td class="raudonas" id="h2" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="pestininkasBaltas8" class="balta" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">&#9823;</div>
            </td>
            <td>
                <div class="desine">2</div>
            </td>
        </tr>
        <tr>
            <td>
                <div class="kaire">1</div>
            </td>
            <td class="raudonas" id="a1" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="bokstasBaltasKaire" class="balta" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">&#9820;
                </div>
            </td>
            <td class="zalias" id="b1" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="zirgasBaltasKaire" class="balta" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">&#9822;
                </div>
            </td>
            <td class="raudonas" id="c1" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="rikisBaltasKaire" class="balta" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">&#9821;
                </div>
            </td>
            <td class="zalias" id="d1" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="valdoveBaltas" class="balta" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">&#9819;
                </div>
            </td>
            <td class="raudonas" id="e1" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="karaliusBaltas" class="balta" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">&#9818;
                </div>
            </td>
            <td class="zalias" id="f1" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="rikisBaltasDesine" class="balta" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">&#9821;
                </div>
            </td>
            <td class="raudonas" id="g1" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="zirgasBaltasDesine" class="balta" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">&#9822;
                </div>
            </td>
            <td class="zalias" id="h1" ondrop="drop(event)" ondragover="allowDrop(event)">
                <div id="bokstasBaltasDesine" class="balta" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">&#9820; </div>
            </td>
            <td>
                <div class="desine">1</div>
            </td>
        </tr>
        <tr>
            <td class="kampas">
            </td>
            <td>
                <div>a</div>
            </td>
            <td>
                <div>b</div>
            </td>
            <td>
                <div>c</div>
            </td>
            <td>
                <div>d</div>
            </td>
            <td>
                <div>e</div>
            </td>
            <td>
                <div>f</div>
            </td>
            <td>
                <div>g</div>
            </td>
            <td>
                <div>h</div>
            </td>
            <td class="kampas">
            </td>
        </tr>
    </table>

    <br>
    <button onclick="anuliuoti()">Anuliuoti</button>
    <br>
    <table id="ejimai">
        <tr>
            <td>Nr.</td>
            <td>Iš</td>
            <td>Į</td>
        </tr>
    </table>


    <script>
        var spalva2 = "#01a101", spalva1 = "#bd2525";   // langelio spalvos, reikalingos langelio spalvos pašviesinimui
        var figuros = ["&#9820;", "&#9822;", "&#9821;", "&#9819;", "&#9818;", "&#9823;"]; //[bokštas, žirgas, rikis, valdovė, pėstininkas]
        var skaiciai = [8, 7, 6, 5, 4, 3, 2, 1];
        var raides = ["a", "b", "c", "d", "e", "f", "g", "h"];
        var lenta = new createMatric(8);            // Kvadratinė n-osios eilės matrica Lenta, figūrų informacijai saugoti
        var istorija = [];                          // figūrų judėjimo istorijai saugoti
        var arTikrinameSacha = false;               // tikrinsime ar šachuojamas karalius
        var sakuojanciosFiguros = [];               // figūros kurios tikrinimo metu šachuoja karalių, kintanti parametras
        var juodasKaralius = new indeksas(0, 4);    // juodo karaliaus pradinė padėtis
        var baltasKaralius = new indeksas(7, 4);    // balto karaliaus pradinė padėtis
        var balti = 1;                              // ar pradeda balti,(gali įgauti reikšmes tik 1 arba 0)
        var arGalimaRokiruote = false;             // ar šiuo metu atliekame veiksmą su karaliumi
        var id,                                     // pasirinktos figūros ID
            parentId,                               // žaidimo lentos langelio id, kuriame stovi pasirinkta figūra
            stationId,                             // žaidimo lentos langelio ID, į kurį statome figūra
            xy,                      // žaidimo lentos langelio koordinatės matricoje Lenta, kuriame stovi pasirinkta figūra
            ab;                      // žaidimo lentos langelio koordinatės matricoje Lenta, į kurį perkeliame figūra
        matricaLentaFormavimas();                   // Matricos lenta duomenų sukūrimas
        //----------------------------------
        // konstruktorius sukurti lentos matrica
        function createMatric(x) {
            return Array(x).fill(0).map(() => Array(x).fill(null));
        }
        // konstruktorius langelio objektui sukurti
        function lentosLangelis(id, canCell, colorCell, chess) {
            this.id = id ? id : '';                         // langelio id
            this.canCell = canCell ? canCell : false;       // ar langelyje galima statyti figūra
            this.colorCell = colorCell ? colorCell : '';    // langelio spalva
            this.chess = chess ? chess : 0;                 // kokia figūra stovi langelyje
        }
        // konstruktorius koordinatės saugoti objektui sukurti
        function indeksas(i, j) {
            this.i = i;
            this.j = j;
        }
        // konstruktorius įvykio objektui sukurti
        function ivykis(id1, chess1, chessId1, id2, chess2, chessId2) {
            this.id1 = id1 ? id1 : '';                  // langelio id, iš kurio juda figūra
            this.chess1 = chess1 ? chess1 : 0;          // kokia figūra juda
            this.chessId1 = chessId1 ? chessId1 : '';   // judančios figūros id
            this.id2 = id2 ? id2 : '';                  // langelio id, į kurį juda figūra
            this.chess2 = chess2 ? chess2 : 0;          // kokia figūra jau stovi langelyje
            this.chessId2 = chessId2 ? chessId2 : '';   // stovinčios figūros id
        }
        // f-ija nupiesianti lenta ir fig8ras joje
        function piestiLenta(){
            // Kai turėsiu daugiau laiko
        }
        // F-ija sukurianti duomenų matrica Lenta
        function matricaLentaFormavimas() {
            for (let i = 0; i < 8; i++) {
                let lentosEilute = [];          // eilutės masyvas
                for (let j = 0; j < 8; j++) {
                    let langelis = new lentosLangelis();                        // sukuriamas lentos langelio informacijos obiektas
                    langelis.id += raides[j] + skaiciai[i];                     // generuojamas langelio ID
                    langelis.colorCell += ((i + j) % 2) ? spalva1 : spalva2;    // generuojama langelio spalva
                    //  toliau generuojame informacija, kokios figūros langeliuose
                    if (i === 0 || i == 7) {                                    // jei pirma arba paskutinė lentos eilutė
                        if (j % 7 === 0) i === 7 ? langelis.chess = 1 : langelis.chess -= 1;    // ar bokštas
                        if (j % 5 === 1) i === 7 ? langelis.chess += 2 : langelis.chess -= 2;   // ar žirgas
                        if (j % 3 === 2) i === 7 ? langelis.chess += 3 : langelis.chess -= 3;   // ar rikis
                        if (j === 3) i === 7 ? langelis.chess += 4 : langelis.chess -= 4;       // ar karalienė
                        if (j === 4) i === 7 ? langelis.chess += 5 : langelis.chess -= 5;       // ar karalius
                    }
                    if (i % 5 === 1) i === 6 ? langelis.chess += 6 : langelis.chess -= 6;       // jie antra arba priešpaskutinė eilutė, ar pėstininkas
                    lenta[i][j] = langelis; // langelis obiektas dedamas į eilutės masyva;
                }
            }
        }
        //================================================================================================================================================
        //\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
        //================================================================================================================================================
        //             Viskas kas susije su vartotojo frafiniu figūros perkelimu ir darbu su įvykiais(event)
        //------------------------------------------------------------------------------------------------------------------------------------------------
        function drag(e) {
            id = e.target.id;                       // paspaustos figūros id priskyrimas (GK - globalus kintamasis)
            parentId = e.target.parentElement.id;   // paspaustos figūros langelio id priskyrimas (GK)
            e.dataTransfer.setData("text", id);
            xy = rastiLangeli(parentId);      // paspausto langelio koordinatės matricoje lenta priskyrimas (GK)
            arJudameSuKaraliumiPirmaKarta();
            generuojaFiguruJudejimoEiliskumaJuodiBalti();
        }
        //paleidus figūrą bet kur
        function dragEnd(e) {
            galimiEjimai(false);                    // figūros judėjimo sufleris atšaukiamas
            arGalimaRokiruote = false              // suteikiama vėl pradinė reikšmė
        }

        function allowDrop(e) {
            ab = reiksmeInd(e.target);     // langelio į kurį padėsime koordinatės matricoje lenta
            if (!lenta[ab.i][ab.j].canCell) return; // ar leidžiamas langelis
            e.preventDefault();                     // reikia kviesti šitą funkciją kad leisti "numesti" elementą 
        }

        function drop(e) {
            e.preventDefault();                         // uždraudžiam standartinį naršyklės veikimą su elementu - kaip kad mygtuko paspaudimas ir pan.
            galimiEjimai(false);                        // atlikus veiksma, figūros judėjimo sufleris anuliuojasi
            atliekamasEjimas();
            jeiSachasKaraliuiAtsauktiVeiksma();
            atliekamRokiruote();
        }
        // Figūros atliekamas ėjimas
        function atliekamasEjimas() {
            stationId = lenta[ab.i][ab.j].id
            let stationCellElement = document.getElementById(stationId);
            keistiLaisvaUzimta();
            jeiguKertameFigura(stationCellElement);
            stationCellElement.appendChild(document.getElementById(lenta[xy.i][xy.j].id).firstElementChild);
        }
        // f-ija  ištrina lentos langelyje stovinčia figūra
        function jeiguKertameFigura(elementas) {
            if (elementas.firstElementChild != null) {
                elementas.removeChild(elementas.firstElementChild)
            }
        }
        // f-ija randa langelio indeksus matricoje lenta, priklausomai nuo to ar langelyje yra figūra ar nėra, gražinama reiksmė indeksų masyvas
        function reiksmeInd(elementas) {
            let index = rastiLangeli(elementas.id);                 // jei figūros nėra
            if (index.i === -1) {
                index = rastiLangeli(elementas.parentElement.id);  // jei figūra yra
            }
            return index;
        }
        // f-ija ieško pasirinkto objekto, pagal id, matricoje lenta, kur elementas objekto id sutiktu su lentos objekto vardu. f-ija per savo vardą, gražina objekto lentoje indeksus išsaugotus dvimaciame masyve.
        function rastiLangeli(langelioID) {
            let index = new indeksas(-1, -1);                      // jei nerandame,  pradinės reikšmės
            for (let i = 0; i < 8; i++) {
                for (let j = 0; j < 8; j++) {
                    if (langelioID == lenta[i][j].id) {
                        index.i = i;
                        index.j = j;
                        return index;
                    }
                }
            }
            return index;
        }
        // f-ija matricoje lenta perstato figūra
        function keistiLaisvaUzimta() {
            sukurtiIstoriniIvyki();
            lenta[ab.i][ab.j].chess = lenta[xy.i][xy.j].chess;
            lenta[xy.i][xy.j].chess = 0;
        }
        // f-ja atlikus ėjima, papildo obijentu masyva istorija
        function sukurtiIstoriniIvyki() {
            istorija.push(new ivykis(lenta[xy.i][xy.j].id, lenta[xy.i][xy.j].chess, id,
                lenta[ab.i][ab.j].id, lenta[ab.i][ab.j].chess, kokiaFigura(lenta[ab.i][ab.j].id)));
            sukurtiIstorijosLentelesEilute(istorija.length - 1);
            pestininkasPasiekeGala();
            balti = ++balti % 2;
        }
        // f-ija sukuria vaizduojamo istorijos įvykio lentelės eilute
        function sukurtiIstorijosLentelesEilute(eilNr) {
            let step = document.createElement("tr");
            step.innerHTML = '<td>' + (eilNr + 1) + '</td><td>' + istorija[eilNr].id1 + '</td><td>' + istorija[eilNr].id2 + '</td>';
            document.getElementById("ejimai").appendChild(step);
        }
        // Pėstininkui pasiekus gali, pavirsta kita figūra     
        function pestininkasPasiekeGala() {
            if (figurosTipas(lenta[xy.i][xy.j].chess) == 6 && (lenta[ab.i][ab.j].id.substr(1, 1) % 7 == "1")) {
                lenta[xy.i][xy.j].chess = lenta[xy.i][xy.j].chess > 0 ? 4 : -4;
                document.getElementById(id).innerHTML = "&#9819"
            }
        }
        // F-ija tikrina ar judame su karaliumi, ir ar juda pirma karta, jei taip, leidžia rokiruotep
        function arJudameSuKaraliumiPirmaKarta() {
            if (arKaraliusPaspaustas(baltasKaralius) && !arJudintaFigura(baltasKaralius)
                || arKaraliusPaspaustas(juodasKaralius) && !arJudintaFigura(juodasKaralius)) {
                arGalimaRokiruote = true;          // if tikrina ar judame su karaliumi, reikalingas rokiruotės atlikimui (GK)
            }
            else {
                arGalimaRokiruote = false;          // if tikrina ar judame su karaliumi, reikalingas rokiruotės atlikimui (GK)
            }
        }
        // f-ija reguliuoja kuri spalva juda
        function generuojaFiguruJudejimoEiliskumaJuodiBalti() {
            if (balti) {                            // ar eilė judėti baltiems? (1-juda balti; 0-juda juodi)
                if (document.getElementById(id).classList.contains("balta")) {  // ar pasirinkta figūra balta
                    galimiEjimai(true);             // figūros judėjimo sufleris
                }
            }
            else if (document.getElementById(id).classList.contains("juoda")) { // ar pasirinkta figūra juoda
                galimiEjimai(true);                 // figūros judėjimo sufleris
            }
        }
        // f-ija tikrina ar judame su karaliumi
        function arKaraliusPaspaustas(karaliausIndex) {
            return (karaliausIndex.i == xy.i && karaliausIndex.j == xy.j);
        }
        // f-ija tikrina, ar tai karaliaus pirmas ėjimas
        function arJudintaFigura(karaliausIndex) {
            for (let i = 0; i < istorija.length; i++) {
                if (istorija[i].id1 == karaliausIndex || istorija[i].id2 == karaliausIndex) {
                    return true;
                }
            }
            return false;
        }
        // f-ija pagal langelio id gražina, jame esančios figūros id arba 0
        function kokiaFigura(langelioID) {
            return document.getElementById(langelioID).childElementCount > 0 ? document.getElementById(langelioID).firstElementChild.id : 0;
        }
        //------------------------------------------
        function atliekamRokiruote() {
            xy = rastiLangeli(parentId);      // paspausto langelio adresas matricoje lenta
            if (arGalimaRokiruote) {
                if (figurosTipas(xy.j - ab.j) == 2) {
                    balti = ++balti % 2;
                    if (xy.j < ab.j) {
                        xy.j = 7;
                        ab.j = 5;
                    }
                    else {
                        xy.j = 0;
                        ab.j = 3;
                    }
                    atliekamasEjimas();
                }
            }
        }
        function karaliusPajudejo(elementas) {
            let figurele = lenta[xy.i][xy.j].chess;
            if (figurele == 5 || figurele == -5) {
                figurele == -5 ? juodasKaralius = reiksmeInd(elementas) : baltasKaralius = reiksmeInd(elementas);
            }
        }
        //================================================================================================================================================
        //\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
        //================================================================================================================================================
        //             Figuru judėjimo taisyklės
        //------------------------------------------------------------------------------------------------------------------------------------------------

        // F-ija: nustato, į kuriuos langelius galima pastatyti figūra
        function galimiEjimai(leistiPastatyti) {
            switch (figurosTipas(lenta[xy.i][xy.j].chess)) {
                case 6:
                    pestininkoTaisykles(leistiPastatyti);
                    break;
                case 1:
                    bokstoTaisykles(leistiPastatyti);
                    break;
                case 2:
                    zirgoTaisykles(leistiPastatyti);
                    break;
                case 3:
                    rikioTaisykles(leistiPastatyti);
                    break;
                case 4:
                    bokstoTaisykles(leistiPastatyti);
                    rikioTaisykles(leistiPastatyti);
                    break;
                case 5:
                    karaliausTaisykles(leistiPastatyti);
                    break;
            }
        }
        // Pėstininko judėjimo taisyklės
        function pestininkoTaisykles(leistiPastatyti) {
            let k1 = k2 = k = xy.i;
            let m = xy.j;
            spalvosPakeitimas(k, m, leistiPastatyti);
            if (lenta[k][m].id.substr(1, 1) != "8" && lenta[k][m].id.substr(1, 1) != "1") {
                if (lenta[xy.i][xy.j].chess < 0) {   // į kurią puse juda figūros
                    k1++;
                    k2 += 2;
                }
                else {
                    k1--;
                    k2 -= 2;
                }
                if (!lenta[k1][m].chess) {                     // ar priešais figūra tuščia
                    lestiPastatytiFigūra(k1, m, leistiPastatyti);  // leisti pastatyti figūra
                    // ar tai figūros pirmas judėjimas, ar figūra galės jame atsistoti
                    if (-1 < k2 && k2 < 8) {
                        if ((lenta[k][m].id.substr(1, 1) == "7" || lenta[k][m].id.substr(1, 1) == "2") && !lenta[k2][m].chess) {
                            lestiPastatytiFigūra(k2, m, leistiPastatyti);
                        }
                    }
                }
                // ar nestovi kairėje lentos pusėje ir ar kirtimo laukelyje kairėje yra ką kirsti                                           
                if (m != 0 && lenta[k1][m - 1].chess != 0 && arSkirtingosSpalvos(lenta[k][m], lenta[k1][m - 1])) {
                    lestiPastatytiFigūra(k1, m - 1, leistiPastatyti);
                    if (arTikrinameSacha && figurosTipas(lenta[k][m].chess) == 5) {
                        sakuojanciosFiguros.push(new indeksas(k, m));
                    }
                }
                // ar nestovi dešinėje lentos pusėje ir ar kirtimo laukelyje dešinėje yra ką kirsti                                           
                if (m != 7 && lenta[k1][m + 1].chess != 0 && arSkirtingosSpalvos(lenta[k][m], lenta[k1][m + 1])) {
                    lestiPastatytiFigūra(k1, m + 1, leistiPastatyti);
                    if (arTikrinameSacha && figurosTipas(lenta[k][m].chess) == 5) {
                        sakuojanciosFiguros.push(new indeksas(k, m));
                    }
                }
            }
        }
        // bokšto judėjimo taisyklės
        function bokstoTaisykles(leistiPastatyti) {
            let k = xy.i;
            let m = xy.j;
            let kaire = desine = virsus = apacia = true;
            spalvosPakeitimas(k, m, leistiPastatyti);
            for (let i = 1; i < 8; i++) {
                if (m + i < 8 && desine) {
                    desine = figuraJudaTiese(k, m + i, leistiPastatyti)
                }
                if (m - i > -1 && kaire) {
                    kaire = figuraJudaTiese(k, m - i, leistiPastatyti)
                }
                if (k - i > -1 && virsus) {
                    virsus = figuraJudaTiese(k - i, m, leistiPastatyti)
                }
                if (k + i < 8 && apacia) {
                    apacia = figuraJudaTiese(k + i, m, leistiPastatyti)
                }
            }
        }
        // žirgo judėjimo taisyklės
        function zirgoTaisykles(leistiPastatyti) {
            let k = xy.i;
            let m = xy.j;
            spalvosPakeitimas(k, m, leistiPastatyti);
            figuraJudaZingsniais(k - 2, m - 1, leistiPastatyti);
            figuraJudaZingsniais(k - 2, m + 1, leistiPastatyti);
            figuraJudaZingsniais(k - 1, m + 2, leistiPastatyti);
            figuraJudaZingsniais(k + 1, m + 2, leistiPastatyti);
            figuraJudaZingsniais(k + 2, m + 1, leistiPastatyti);
            figuraJudaZingsniais(k + 2, m - 1, leistiPastatyti);
            figuraJudaZingsniais(k + 1, m - 2, leistiPastatyti);
            figuraJudaZingsniais(k - 1, m - 2, leistiPastatyti);
        }
        // rikio judėjimo taisyklės
        function rikioTaisykles(leistiPastatyti) {
            let k = xy.i;
            let m = xy.j;
            let kaire = desine = virsus = apacia = true;
            spalvosPakeitimas(k, m, leistiPastatyti);
            for (let i = 1; i < 8; i++) {
                if (m + i < 8 && k + i < 8 && desine) {
                    desine = figuraJudaTiese(k + i, m + i, leistiPastatyti)
                }
                if (m - i > -1 && k - i > -1 && kaire) {
                    kaire = figuraJudaTiese(k - i, m - i, leistiPastatyti)
                }
                if (k - i > -1 && m + i < 8 && virsus) {
                    virsus = figuraJudaTiese(k - i, m + i, leistiPastatyti)
                }
                if (k + i < 8 && m - i > -1 && apacia) {
                    apacia = figuraJudaTiese(k + i, m - i, leistiPastatyti)
                }
            }
        }
        // karaliuas judėjimo taisyklės
        function karaliausTaisykles(leistiPastatyti) {
            let k = xy.i - 1;
            let m = xy.j - 1;
            spalvosPakeitimas(k + 1, m + 1, leistiPastatyti)
            if (arGalimaRokiruote) {
                rokiruote(leistiPastatyti);
            }
            spalvosPakeitimas(k + 1, m + 1, leistiPastatyti)
            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 3; j++) {
                    if (!arYraKitasKaralius(k + i, m + j)) {
                        figuraJudaZingsniais(k + i, m + j, leistiPastatyti);
                    }
                }
            }
        }


        function arYraKitasKaralius(k, m) {
            --k;
            --m;
            let karaliusPriesu = balti ? -5 : 5;
            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 3; j++) {
                    if (-1 < k + i && k + i < 8 && -1 < m + j && m + j < 8 && lenta[k + i][m + j].chess == karaliusPriesu)
                        return true;
                }
            }
            return false;
        }


        function figuraJudaTiese(k, m, leistiPastatyti) {
            let tusciaslaukelis = false;
            if ((-1 < k && k < 8) && (-1 < m && m < 8)) {
                tusciaslaukelis = true;
                if (!lenta[k][m].chess) {
                    lestiPastatytiFigūra(k, m, leistiPastatyti);
                }
                else {
                    tusciaslaukelis = false;
                    if (arSkirtingosSpalvos(lenta[xy.i][xy.j], lenta[k][m])) {
                        lestiPastatytiFigūra(k, m, leistiPastatyti);
                        if (arTikrinameSacha && figurosTipas(lenta[k][m].chess) == 5) {
                            sakuojanciosFiguros.push(new indeksas(k, m));
                        }
                    }
                }
            }
            return tusciaslaukelis;
        }

        function figuraJudaZingsniais(k, m, leistiPastatyti) {
            if ((-1 < k && k < 8) && (-1 < m && m < 8)) {
                if (!lenta[k][m].chess) {
                    lestiPastatytiFigūra(k, m, leistiPastatyti);
                }
                else {
                    if (arSkirtingosSpalvos(lenta[xy.i][xy.j], lenta[k][m])) {
                        lestiPastatytiFigūra(k, m, leistiPastatyti);
                        if (arTikrinameSacha && figurosTipas(lenta[k][m].chess) == 5) {
                            sakuojanciosFiguros.push(new indeksas(k, m));
                        }
                    }
                }
            }
        }
        //================================================================================================================================================
        //\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
        //================================================================================================================================================
        //             Anuliavimas, šachas, rokiruotė
        //------------------------------------------------------------------------------------------------------------------------------------------------
        function anuliuoti() {
            let list = document.getElementById("ejimai");   // lentelės su id "ejimai", paimami visos eilutes
            if (istorija.length && list.hasChildNodes()) {  // ar istorijoje yra įrašų
                let ivyk = istorija[istorija.length - 1];   // pasiimame paskutinį įvykį
                istorija.pop();                             // iš istorijos ištriname paskutinį įvykį
                let index1 = rastiLangeli(ivyk.id1);        // iš kokio langelio atliktas veiksmas (langelis A)
                let index2 = rastiLangeli(ivyk.id2);        // į kokį langelį atliktas veiksmas (langelis B)
                document.getElementById(ivyk.id2).innerHTML = '';   // išvalomas langelis B
                lenta[index1.i][index1.j].chess = ivyk.chess1;
                lenta[index2.i][index2.j].chess = ivyk.chess2;
                document.getElementById(ivyk.id1).innerHTML = piestiFiguraLentoje(ivyk.chess1, ivyk.chessId1);
                document.getElementById(ivyk.id2).innerHTML = (ivyk.chess2 != 0 ? piestiFiguraLentoje(ivyk.chess2, ivyk.chessId2) : '');
                list.removeChild(list.lastChild);
                balti = ++balti % 2;
                let karalius;
                if (index1.j ==7 &&  index2.j == 5 && figurosTipas(lenta[index2.i][index2.j + 1].chess) == 5
                    || index1.j == 0 && index2.j == 3 && figurosTipas(lenta[index2.i][index2.j - 1].chess) == 5) {
                    karalius == -5 ? juodasKaralius = new indeksas(0, 4) : baltasKaralius = new indeksas(7, 4);
                    anuliuoti();
                    balti = ++balti % 2;
                }
            }
        }

        function piestiFiguraLentoje(cellFigura, cellFiguraId) {
            let piesinukas = '<div id="';
            piesinukas += cellFiguraId;
            piesinukas += '" class="';
            piesinukas += (cellFigura > 0 ? 'balta' : 'juoda');
            piesinukas += '" draggable="true" ondragstart="drag(event)" ondragend="dragEnd(event)">'
            piesinukas += figuros[figurosTipas(cellFigura) - 1];
            piesinukas += '</div>';
            return piesinukas;
        }
        // f-ija atsaukia veiksma jei karaliui šachas
        function jeiSachasKaraliuiAtsauktiVeiksma() {
            arSachasKaraliausLangeliui();
            if (sakuojanciosFiguros.length > 0) {
                anuliuoti();
            }
            isvalytiMasyva(sakuojanciosFiguros);
        }
        // f-ija išvalo masyva
        function isvalytiMasyva(mas) {
            while (mas.length > 0) {
                mas.shift();
            }
        }
        // f-cija tikrina ar karalius šachuojamas
        function arSachasKaraliausLangeliui() {
            arTikrinameSacha = true;
            for (let i = 0; i < 8; i++) {
                for (let j = 0; j < 8; j++) {
                    if (balti ? lenta[i][j].chess > 0 : lenta[i][j].chess < 0) {
                        xy = new indeksas(i, j);
                        galimiEjimai(false);
                    }
                }
            }
            arTikrinameSacha = false;
        }
        // f-ija
        function rokiruote(leistiPastatyti) {
            let rokiruoteslangeliaiDesinen = [xy, new indeksas(xy.i, 5), new indeksas(xy.i, 6), new indeksas(xy.i, 7)];
            let rokiruoteslangeliaiKairen = [xy, new indeksas(xy.i, 3), new indeksas(xy.i, 2), new indeksas(xy.i, 1), new indeksas(xy.i, 0)];
            let index = xy;
            rokiruoteIVienaPusia(rokiruoteslangeliaiDesinen, leistiPastatyti);
            rokiruoteIVienaPusia(rokiruoteslangeliaiKairen, leistiPastatyti);
            xy = index;
        }

        function tarpasTuscias(indMas) {
            let kiek = 0;
            for (let i = 1; i < indMas.length - 1; i++) {
                if (lenta[indMas[i].i][indMas[i].j].chess != 0) {
                    kiek++;
                }
            }
            return kiek == 0 ? true : false;
        }

        function rokiruoteIVienaPusia(index, leistiPastatyti) {
            let nElem = index.length-1; // paskutinio elemento indeksas
            if (tarpasTuscias(index) && figurosTipas(lenta[index[nElem].i][index[nElem].j].chess) == 1) {
                let i
                arGalimaRokiruote = false;
                figura = lenta[index[nElem].i][index[nElem].j].chess;
                balti = ++balti % 2;
                arSachasKaraliausLangeliui();
                for (i = 0; i < nElem; i++) {   // ciklas juda iki priešpaskutinio elemento
                    lenta[index[i + 1].i][index[i + 1].j].chess = lenta[index[i].i][index[i].j].chess;
                    lenta[index[i].i][index[i].j].chess = 0;
                    arSachasKaraliausLangeliui();
                }
                console.log(sakuojanciosFiguros.length);
                if (!arYraKitasKaralius(index[2]) && sakuojanciosFiguros.length == 0) {
                    lestiPastatytiFigūra(index[2].i, index[2].j, leistiPastatyti);
                }
                    arGalimaRokiruote = true;
                balti = ++balti % 2;
                lenta[index[0].i][index[0].j].chess = lenta[index[nElem].i][index[nElem].j].chess;
                lenta[index[nElem].i][index[nElem].j].chess = figura;
                isvalytiMasyva(sakuojanciosFiguros);
            }
        }
        function arMatas(){
            let matas = false;
            // kai turėsiu daugiau laiko
        }
        //================================================================================================================================================
        //\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
        //================================================================================================================================================
        //             Kitos funkcijos ir spalvu kaitoliojimas
        //------------------------------------------------------------------------------------------------------------------------------------------------
        // f-ija ignoruoja figūrų spalva
        function figurosTipas(tip) {
            return tip > 0 ? tip : (tip *= -1);
        }
        function arSkirtingosSpalvos(f1, f2) {
            return (f1.chess > 0 && 0 > f2.chess || f1.chess < 0 && 0 < f2.chess) ? true : false;
        }
        // f-ija: aprašoma kad į langelį galima pastatyti figūra ir tas langelis pašviesinamas
        function lestiPastatytiFigūra(k, m, leistiPastatyti) {
            lenta[k][m].canCell = leistiPastatyti;             // leidžiama statyti figūra į nurodyta langelį
            spalvosPakeitimas(k, m, leistiPastatyti);
        }
        // f-ija: langelio šviesinis efektas
        function spalvosPakeitimas(k, m, leistiPastatyti) {
            document.getElementById(lenta[k][m].id).style.backgroundColor = (leistiPastatyti ? LightenDarkenColor(lenta[k][m].colorCell, 70) : lenta[k][m].colorCell);
            document.getElementById(lenta[k][m].id).style.borderWidth = (leistiPastatyti ? "0.5vmin" : "0px");
        }
        // pavokta neaiškaus autoriaus funkcija
        function LightenDarkenColor(col, amt) {

            var usePound = false;

            if (col[0] == "#") {
                col = col.slice(1);
                usePound = true;
            }
            var num = parseInt(col, 16);
            var r = (num >> 16) + amt;
            if (r > 255) r = 255;
            else if (r < 0) r = 0;
            var b = ((num >> 8) & 0x00FF) + amt;
            if (b > 255) b = 255;
            else if (b < 0) b = 0;
            var g = (num & 0x0000FF) + amt;
            if (g > 255) g = 255;
            else if (g < 0) g = 0;
            return (usePound ? "#" : "") + (g | (b << 8) | (r << 16)).toString(16);

        }

    </script>
</body>

</html>